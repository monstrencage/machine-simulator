<div id="simulator" class="section">
  <h1><i class="fas fa-robot"></i> Simulateur<div class="tm-name" id="tm-name"></div></h1>
  <div class="input-panel panel section">
    {% if include.init-word %}
    <input class="input-field" type='text' id='input-str' value='{{include.init-word}}'/>
    {% else %}
    <input class="input-field" type='text' id='input-str'/>
    {% endif %}
    <button id="load-btn" class="btn btn--primary txt"><i class="fa fa-undo"></i> Charger mot d'entrée</button>
  </div>
  <div class="section simulator-panel" id="simulator-panel" >
    
  </div>
</div>
<div id="render" class="section render machine-src">
  <h1><i class="fa fa-edit"></i>Spécification de la machine</h1>
  <div class="src panel" id="source-panel">
    <pre class="src-display" id="source-display">
      <!-- <span></span> -->
    </pre>
      <textarea class='src'>{% if include.init-machine %}{{ include.init-machine }}{% endif %}
      </textarea>
  </div>
  <div class="compilation-msg panel" id="compilation-panel">
    <h3 style="margin-top:0">Messages de sortie du compilateur</h3>
    <p class="compilation-msg"></p>
  </div>
</div>

<script>
  let renderElt = new RenderElt("source-panel",
                                'compilation-panel')
  
  let render = new Render(renderElt, new TMParser())
  
  const simulator = new Simulator("simulator-panel",
                                  GraphTM,
                                  "tm-name",
                                  TapeVis,
                                  TuringEnv)

  
  function load(input, simulator){
          simulator.inputword = input.value
          input.blur()      
  }
  // function compile(editor, input, simulator){
  //     let output = editor.value
  //     if (output){
  //         simulator.machine = output
  //         load(input, simulator);
  //     }
  // }

  function link(render, input, inputBtn,simulator){
      
      input.onkeydown =
          event => {
              if (event.key === 'Enter') { load(input,simulator) }
          }
      
      inputBtn.onclick = e => {
          load(input,simulator)
          simulator.focus()
      }

      simulator.machine = render.value
      load(input, simulator)
  }

  link(
      render,
      document.getElementById("input-str"),
      document.getElementById("load-btn"),
      simulator
  )
  


</script>
